{% load i18n %}
{% load crispy_forms_tags %}
{#  Provides a RiotJS tag to view requests #}
<request>
    {{ request.items }}
    <div class="col col-lg-6">
        <h3>{ message } <label class='badge'>{ requests.length }</label></h3>
        <button onclick={ shelve_requests } class="btn btn-sm btn-primary">To Local</button>
        <button onclick={ unshelve_requests } class="btn btn-sm btn-primary">From Local</button>

        <div class="panel panel-default">
            <div class="panel-body">
                <h3> Request Monitoring</h3>

                <p>Keeps a record of the requests which have been made, and the result.</p>
                <p>If a request cannot be responded to by the server it can be shelved in local storage</p>

            </div>
        </div>


        <table class="table table-condensed table-bordered">

            <thead>
                <tr><th>url</th><th>method</th><th>data</th><th>status</th><th>actions</th></tr>
            </thead>
            <tbody>
                <tr class="request" each={ requests }>
                    <td>{ url }</td>
                    <td>{ method }</td>
                    <td>{ data }</td>
                    <td class="http-status-code-{ok: status == 200, created: status == 201, bad-request: status >= 400 && status < 500, internal-server-error: status > 500 }"> { status }</td>
                    <td>
                        <button disabled="{disabled: status != 0 }" onclick={ parent.request_do } class="btn btn-sm btn-primary">Make request</button>
                        <button disabled="{disabled: status != 0 }" onclick={ parent.request_remove } class="btn btn-sm btn-primary">Remove request</button>

                    </td>
                </tr>
            </tbody>
        </table>

    </div>
    <style scoped>
        :scope { font-size: 2rem }
        h3 { color: #444 }
        ul, p, table { font-size: 1rem }
        li { list-style-type: none }

        .panel.panel-default:hover {
            border-color:red;
        }

        .person.edit .panel.panel-default {
            border-color:green;
        }
        .http-status-code-ok {
            color:green;
        }
        .http-status-code-created {
            color:green;
        }
        .http-status-code-bad-request {
            color:red;
        }
        .http-status-code-internal-server-error {
            color:red;
        }

    </style>

{#    <script>#}

    var self = this
    self.message = 'Requests'

    self.on('mount', function() { RiotControl.trigger('requests_init'); self.update() });

    RiotControl.on('requests_changed', function(requests) { self.requests = requests; self.update() })

    RiotControl.on('request_add',function(){ self.update() })

    request_do(e){ RiotControl.trigger('request_do', e.item) }

    request_remove(e){ RiotControl.trigger('request_remove', e.item) }

    shelve_requests(e){RiotControl.trigger('shelve_requests')}

    unshelve_requests(e){RiotControl.trigger('unshelve_requests')}

{#    </script>#}
</request>
